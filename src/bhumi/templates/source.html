<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bhumi — Gaia DR3 {{ source_id }}</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script
      src="https://cdn.plot.ly/plotly-2.35.2.min.js"
      charset="utf-8"
    ></script>
  </head>
  <body>
    <header>
      <a href="/" class="home-link">Bhumi</a>
      <span class="source-id-header">Gaia DR3 {{ source_id }}</span>
      <div class="external-links">
        <a
          href="https://simbad.u-strasbg.fr/simbad/sim-id?Ident=Gaia+DR3+{{ source_id }}"
          target="_blank"
          rel="noopener"
          class="ext-link-btn"
          >SIMBAD</a
        >
        <a
          href="https://www.legacysurvey.org/viewer?ra={{ source.ra }}&dec={{ source.dec }}&layer=ls-dr10&zoom=16"
          target="_blank"
          rel="noopener"
          class="ext-link-btn"
          >Legacy Survey</a
        >
      </div>
    </header>

    <main>
      {% if narrative %}
      <p class="narrative">{{ narrative }}</p>
      {% endif %}

      <!-- Astrometry Section -->
      <section class="card">
        <h2>Astrometry</h2>
        <div class="two-col-grid">
          <table class="data-table">
            <tbody>
              <tr>
                <td class="label">RA, Dec (ICRS)</td>
                <td>
                  {{ "%.6f"|format(source.ra) }}°, {{ "%.6f"|format(source.dec)
                  }}°
                </td>
              </tr>
              <tr>
                <td class="label">l, b (Galactic)</td>
                <td>
                  {{ "%.6f"|format(source.l) }}°, {{ "%.6f"|format(source.b) }}°
                </td>
              </tr>
              <tr>
                <td class="label">Parallax</td>
                <td>
                  {% if source.parallax is not none %} {{
                  "%.4f"|format(source.parallax) }} {% if source.parallax_error
                  is not none %} ± {{ "%.4f"|format(source.parallax_error) }} {%
                  endif %} mas {% if source.parallax_over_error is not none %}
                  <span class="snr"
                    >(S/N = {{ "%.1f"|format(source.parallax_over_error)
                    }})</span
                  >
                  {% endif %} {% else %} — {% endif %}
                </td>
              </tr>
              <tr>
                <td class="label">Distance</td>
                <td>
                  {% if source.distance_kpc is not none %} {{
                  "%.4f"|format(source.distance_kpc) }} kpc {% else %} — {%
                  endif %}
                </td>
              </tr>
              <tr>
                <td class="label">Distance modulus</td>
                <td>
                  {% if source.distance_modulus is not none %} {{
                  "%.3f"|format(source.distance_modulus) }} mag {% else %} — {%
                  endif %}
                </td>
              </tr>
            </tbody>
          </table>
          <table class="data-table">
            <tbody>
              <tr>
                <td class="label">μ<sub>α*</sub></td>
                <td>
                  {% if source.pmra is not none %} {{ "%.4f"|format(source.pmra)
                  }} {% if source.pmra_error is not none %} ± {{
                  "%.4f"|format(source.pmra_error) }} {% endif %} mas/yr {% if
                  source.pmra_snr is not none %}
                  <span class="snr"
                    >(S/N = {{ "%.1f"|format(source.pmra_snr) }})</span
                  >
                  {% endif %} {% else %} — {% endif %}
                </td>
              </tr>
              <tr>
                <td class="label">μ<sub>δ</sub></td>
                <td>
                  {% if source.pmdec is not none %} {{
                  "%.4f"|format(source.pmdec) }} {% if source.pmdec_error is not
                  none %} ± {{ "%.4f"|format(source.pmdec_error) }} {% endif %}
                  mas/yr {% if source.pmdec_snr is not none %}
                  <span class="snr"
                    >(S/N = {{ "%.1f"|format(source.pmdec_snr) }})</span
                  >
                  {% endif %} {% else %} — {% endif %}
                </td>
              </tr>
              <tr>
                <td class="label">Total PM / v<sub>tan</sub></td>
                <td>
                  {% if source.pm_total is not none %} {{
                  "%.4f"|format(source.pm_total) }} mas/yr {% if
                  source.v_tan_km_s is not none %} → {{
                  "%.2f"|format(source.v_tan_km_s) }} km/s {% endif %} {% else
                  %} — {% endif %}
                </td>
              </tr>
              <tr>
                <td class="label">Radial velocity</td>
                <td>
                  {% if source.has_radial_velocity %} {{
                  "%.2f"|format(source.radial_velocity) }} {% if
                  source.radial_velocity_error is not none %} ± {{
                  "%.2f"|format(source.radial_velocity_error) }} {% endif %}
                  km/s {% if source.rv_snr is not none %}
                  <span class="snr"
                    >(S/N = {{ "%.1f"|format(source.rv_snr) }})</span
                  >
                  {% endif %} {% else %} — {% endif %}
                </td>
              </tr>
              {% if source.ruwe is not none %}
              <tr>
                <td class="label">RUWE</td>
                <td>{{ "%.2f"|format(source.ruwe) }}</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Photometry Section -->
      <section class="card">
        <h2>Photometry</h2>
        <div class="two-col-grid">
          <table class="data-table">
            <tbody>
              <tr>
                <td class="label">G</td>
                <td>
                  {% if source.phot_g_mean_mag is not none %} {{
                  "%.3f"|format(source.phot_g_mean_mag) }} mag {% else %}—{%
                  endif %}
                </td>
              </tr>
              <tr>
                <td class="label">BP</td>
                <td>
                  {% if source.phot_bp_mean_mag is not none %} {{
                  "%.3f"|format(source.phot_bp_mean_mag) }} mag {% else %}—{%
                  endif %}
                </td>
              </tr>
              <tr>
                <td class="label">RP</td>
                <td>
                  {% if source.phot_rp_mean_mag is not none %} {{
                  "%.3f"|format(source.phot_rp_mean_mag) }} mag {% else %}—{%
                  endif %}
                </td>
              </tr>
            </tbody>
          </table>
          <table class="data-table">
            <tbody>
              <tr>
                <td class="label">BP − RP</td>
                <td>
                  {% if source.phot_bp_mean_mag is not none and
                  source.phot_rp_mean_mag is not none %} {{
                  "%.3f"|format(source.phot_bp_mean_mag -
                  source.phot_rp_mean_mag) }} mag {% else %}—{% endif %}
                </td>
              </tr>
              <tr>
                <td class="label">G − RP</td>
                <td>
                  {% if source.phot_g_mean_mag is not none and
                  source.phot_rp_mean_mag is not none %} {{
                  "%.3f"|format(source.phot_g_mean_mag -
                  source.phot_rp_mean_mag) }} mag {% else %}—{% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>Color–Magnitude Diagram (nearby stars)</h3>
        <div id="cmd-plot" class="plot-container">
          <p class="loading">Loading CMD...</p>
        </div>
      </section>

      <!-- RVS Spectrum Section (conditionally shown) -->
      <section class="card" id="rvs-section">
        <h2>RVS Spectrum</h2>
        <div id="rvs-plot" class="plot-container">
          <p class="loading">Checking for RVS spectrum...</p>
        </div>
      </section>

      <!-- XP Sampled Spectrum Section (conditionally shown) -->
      <section class="card" id="xp-section">
        <h2>XP Sampled Spectrum (BP/RP)</h2>
        <div id="xp-plot" class="plot-container">
          <p class="loading">Checking for XP spectrum...</p>
        </div>
      </section>

      <!-- Stellar Parameters (value-added catalogs) -->
      {% if andrae or zhang %}
      <section class="card">
        <h2>Stellar Parameters</h2>
        <table class="data-table stellar-params-table">
          <thead>
            <tr>
              <th></th>
              <th>Andrae+2023</th>
              <th>Zhang, Green &amp; Rix 2023</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="label">T<sub>eff</sub></td>
              <td>
                {% if andrae and andrae.teff_xgboost is not none %}
                  {{ "%.0f"|format(andrae.teff_xgboost) }} K
                {% else %}—{% endif %}
              </td>
              <td>
                {% if zhang and zhang.zhang_teff is not none %}
                  {{ "%.0f"|format(zhang.zhang_teff) }}
                  {% if zhang.zhang_teff_err is not none %} ± {{ "%.0f"|format(zhang.zhang_teff_err) }}{% endif %}
                  K
                {% else %}—{% endif %}
              </td>
            </tr>
            <tr>
              <td class="label">log g</td>
              <td>
                {% if andrae and andrae.logg_xgboost is not none %}
                  {{ "%.3f"|format(andrae.logg_xgboost) }} dex
                {% else %}—{% endif %}
              </td>
              <td>
                {% if zhang and zhang.zhang_logg is not none %}
                  {{ "%.3f"|format(zhang.zhang_logg) }}
                  {% if zhang.zhang_logg_err is not none %} ± {{ "%.3f"|format(zhang.zhang_logg_err) }}{% endif %}
                  dex
                {% else %}—{% endif %}
              </td>
            </tr>
            <tr>
              <td class="label">[M/H] · [Fe/H]</td>
              <td>
                {% if andrae and andrae.mh_xgboost is not none %}
                  [M/H] = {{ "%.3f"|format(andrae.mh_xgboost) }} dex
                {% else %}—{% endif %}
              </td>
              <td>
                {% if zhang and zhang.zhang_feh is not none %}
                  [Fe/H] = {{ "%.3f"|format(zhang.zhang_feh) }}
                  {% if zhang.zhang_feh_err is not none %} ± {{ "%.3f"|format(zhang.zhang_feh_err) }}{% endif %}
                  dex
                {% else %}—{% endif %}
              </td>
            </tr>
            {% if zhang and zhang.zhang_extinction is not none %}
            <tr>
              <td class="label">Extinction E</td>
              <td>—</td>
              <td>
                {{ "%.3f"|format(zhang.zhang_extinction) }}
                {% if zhang.zhang_extinction_err is not none %} ± {{ "%.3f"|format(zhang.zhang_extinction_err) }}{% endif %}
                mag
              </td>
            </tr>
            {% endif %}
            {% if zhang and zhang.zhang_parallax is not none %}
            <tr>
              <td class="label">ϖ (spectrophot.)</td>
              <td>—</td>
              <td>
                {{ "%.4f"|format(zhang.zhang_parallax) }}
                {% if zhang.zhang_parallax_err is not none %} ± {{ "%.4f"|format(zhang.zhang_parallax_err) }}{% endif %}
                mas
                {% if zhang.zhang_distance_kpc is not none %}
                  → {{ "%.4f"|format(zhang.zhang_distance_kpc) }} kpc
                {% endif %}
              </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </section>
      {% endif %}

      <!-- Variability & Multiplicity -->
      <section class="card">
        <h2>Variability &amp; Multiplicity</h2>

        {% if variability %}
        <h3>Variability Classification</h3>
        <table class="data-table">
          <tbody>
            {% if variability.best_class_name is defined %}
            <tr>
              <td class="label">Classification</td>
              <td>
                {{ variability.best_class_name }}
                {% if variability.best_class_description %}
                  <span class="note" style="margin-left: 0.5em">({{ variability.best_class_description }})</span>
                {% endif %}
              </td>
            </tr>
            {% endif %}
            {% if variability.best_class_score is not none %}
            <tr>
              <td class="label">Classifier score</td>
              <td>{{ "%.4f"|format(variability.best_class_score) }}</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
        {% else %}
        <p class="note">No variability detected in Gaia DR3.</p>
        {% endif %}

        {% if nss_orbit %}
        <h3>Non-Single-Star Orbit</h3>
        <table class="data-table">
          <tbody>
            {% if nss_orbit.nss_solution_type is defined %}
            <tr>
              <td class="label">Solution type</td>
              <td>{{ nss_orbit.nss_solution_type }}</td>
            </tr>
            {% endif %}
            {% if nss_orbit.period is not none %}
            <tr>
              <td class="label">Period</td>
              <td>{{ "%.4f"|format(nss_orbit.period) }} days</td>
            </tr>
            {% endif %}
            {% if nss_orbit.eccentricity is not none %}
            <tr>
              <td class="label">Eccentricity</td>
              <td>{{ "%.4f"|format(nss_orbit.eccentricity) }}</td>
            </tr>
            {% endif %}
            {% if nss_orbit.semi_amplitude_primary is not none %}
            <tr>
              <td class="label">Semi-amplitude</td>
              <td>{{ "%.4f"|format(nss_orbit.semi_amplitude_primary) }} km/s</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
        {% elif not variability %}
        <p class="note">
          This source has no variability flag or non-single-star solution in
          Gaia DR3, suggesting it is likely a non-variable single star.
        </p>
        {% else %}
        <p class="note">No non-single-star solution in Gaia DR3.</p>
        {% endif %}
      </section>

      <!-- Orbit Section (only if 6D) -->
      {% if source.has_6d %}
      <section class="card">
        <h2>Galactic Orbit</h2>
        <p class="note">Integrated 8 Gyr backward in <a href="https://gala.adrian.pw">Gala's MilkyWayPotential v2</a>.</p>

        <div id="orbit-loading" class="loading">Computing orbit...</div>

        <div id="orbit-plots" class="orbit-grid" style="display: none">
          <div id="orbit-xy" class="plot-container"></div>
          <div id="orbit-xz" class="plot-container"></div>
          <div id="orbit-Rz" class="plot-container"></div>
        </div>

        <div id="galcen-section" style="display: none">
          <h3>Galactocentric Velocities</h3>
          <div class="velocity-tables">
            <div>
              <h4>Cartesian</h4>
              <table class="data-table" id="vel-cartesian"></table>
            </div>
            <div>
              <h4>Cylindrical</h4>
              <table class="data-table" id="vel-cylindrical"></table>
            </div>
          </div>

          <h3>Orbital Parameters</h3>
          <table class="data-table" id="orbit-params"></table>
        </div>
      </section>
      {% endif %}
    </main>

    <footer>
      <p>Bhumi · Gaia DR3 source viewer · Data from ESA/Gaia/DPAC</p>
    </footer>

    <script>
      const SOURCE_ID = "{{ source_id }}";
      const HAS_6D = {{ source.has_6d | tojson }};
    </script>
    <script src="/static/app.js"></script>
  </body>
</html>
